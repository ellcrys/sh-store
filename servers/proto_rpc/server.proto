syntax = "proto3";
package proto_rpc;
import "github.com/gogo/protobuf/gogoproto/gogo.proto";

service API {
    rpc CreateAccount(CreateAccountMsg) returns (GetObjectResponse);
    rpc CreateBucket(CreateBucketMsg) returns (Bucket);
    rpc CreateObjects(CreateObjectsMsg) returns (GetObjectsResponse);
    rpc CreateSession(Session) returns (Session);
    rpc GetSession(Session) returns (Session);
    rpc DeleteSession(Session) returns (Session);
    rpc CommitSession(Session) returns (Session);
    rpc RollbackSession(Session) returns (Session);
    rpc GetObjects(GetObjectMsg) returns (GetObjectsResponse);
    rpc CountObjects(GetObjectMsg) returns (ObjectCountResponse);
    rpc UpdateObjects(UpdateObjectsMsg) returns (AffectedResponse);
    rpc DeleteObjects(DeleteObjectsMsg) returns (AffectedResponse);
    rpc GetAccount(GetAccountMsg) returns (GetObjectResponse);
    rpc CreateMapping(CreateMappingMsg) returns (CreateMappingResponse);
    rpc GetMapping(GetMappingMsg) returns (GetMappingResponse);
    rpc GetAllMapping(GetAllMappingMsg) returns (GetAllMappingResponse);
}

// CreateBucketMsg represents a request to create a bucket
message CreateBucketMsg {
    string name = 1         [(gogoproto.jsontag) = "name,omitempty", (gogoproto.moretags) = 'structs:"name,omitempty" mapstructure:"name,omitempty"'];
    bool immutable = 2      [(gogoproto.jsontag) = "immutable,omitempty", (gogoproto.moretags) = 'structs:"immutable,omitempty" mapstructure:"immutable,omitempty"'];
}

// GetBucketResponse represents a bucket
message Bucket {
    string ID = 1               [(gogoproto.jsontag) = "id,omitempty", (gogoproto.moretags) = 'structs:"id,omitempty" mapstructure:"id,omitempty"'];
    string name = 2             [(gogoproto.jsontag) = "name,omitempty", (gogoproto.moretags) = 'structs:"name,omitempty" mapstructure:"name,omitempty"'];
    bool immutable = 3          [(gogoproto.jsontag) = "immutable,omitempty", (gogoproto.moretags) = 'structs:"immutable,omitempty" mapstructure:"immutable,omitempty"'];
    string account = 4         [(gogoproto.jsontag) = "account,omitempty", (gogoproto.moretags) = 'structs:"account,omitempty" mapstructure:"immutable,omitempty"'];
    int64 createdAt = 5         [(gogoproto.jsontag) = "created_at,omitempty", (gogoproto.moretags) = 'structs:"created_at,omitempty" mapstructure:"created_at,omitempty"'];
}

// GetAllMappingMsg represents a request for recent mappings
message GetAllMappingMsg {
    int32 limit = 1           [(gogoproto.jsontag) = "limit,omitempty", (gogoproto.moretags) = 'structs:"limit,omitempty" mapstructure:"limit,omitempty"']; 
}

// GetAllMappingResponse represents a response container all mappings encoded in JSON
message GetAllMappingResponse {
    bytes mappings = 1        [(gogoproto.jsontag) = "mappings,omitempty", (gogoproto.moretags) = 'structs:"mappings,omitempty" mapstructure:"mappings,omitempty"']; 
}

// GetMappingMsg represents a request for a mapping
message GetMappingMsg {
    string name = 1          [(gogoproto.jsontag) = "name,omitempty", (gogoproto.moretags) = 'structs:"name,omitempty" mapstructure:"name,omitempty"']; 
}

// GetMappingResponse represents a response containing a mapping
message GetMappingResponse {
    string name = 1             [(gogoproto.jsontag) = "name,omitempty", (gogoproto.moretags) = 'structs:"name,omitempty" mapstructure:"name,omitempty"']; 
    string bucket = 2           [(gogoproto.jsontag) = "bucket,omitempty", (gogoproto.moretags) = 'structs:"bucket,omitempty" mapstructure:"bucket,omitempty"']; 
    bytes mapping = 3           [(gogoproto.jsontag) = "mapping,omitempty", (gogoproto.moretags) = 'structs:"mapping,omitempty" mapstructure:"mapping,omitempty"']; 
}

// CreateMappingMsg represents mapping creation parameters
message CreateMappingMsg {
    // The name of the mapping
    string name = 1         [(gogoproto.jsontag) = "name,omitempty", (gogoproto.moretags) = 'structs:"name,omitempty" mapstructure:"name,omitempty"']; 

    // The bucket name
    string bucket =  2        [(gogoproto.jsontag) = "bucket,omitempty", (gogoproto.moretags) = 'structs:"bucket,omitempty" mapstructure:"bucket,omitempty"']; 
    
    // JSON mapping structure as bytes
    bytes mapping = 3          [(gogoproto.jsontag) = "mapping,omitempty", (gogoproto.moretags) = 'structs:"mapping,omitempty" mapstructure:"mapping,omitempty"'];
}

message CreateMappingResponse {
    string ID = 1               [(gogoproto.jsontag) = "id,omitempty", (gogoproto.moretags) = 'structs:"id,omitempty" mapstructure:"id,omitempty"'];
    string Bucket = 2           [(gogoproto.jsontag) = "bucket,omitempty", (gogoproto.moretags) = 'structs:"bucket,omitempty" mapstructure:"bucket,omitempty"'];
    string Name = 3             [(gogoproto.jsontag) = "name,omitempty", (gogoproto.moretags) = 'structs:"name,omitempty" mapstructure:"name,omitempty"'];
}

// GetAccountMsg represents an account request message
message GetAccountMsg {
    string ID = 1   [(gogoproto.jsontag) = "id,omitempty", (gogoproto.moretags) = 'structs:"id,omitempty" mapstructure:"id,omitempty"'];
}

// ObjectCountResponse represents object counts 
message ObjectCountResponse {
    int64 count = 1         [(gogoproto.jsontag) = "count", (gogoproto.moretags) = 'structs:"count,omitempty" mapstructure:"count,omitempty"'];
}

// GetObjectMsg represents query parameters for retrieving objects
message GetObjectMsg {
    string bucket = 1                [(gogoproto.jsontag) = "bucket,omitempty", (gogoproto.moretags) = 'structs:"bucket,omitempty" mapstructure:"bucket,omitempty"'];
    bytes query = 2                  [(gogoproto.jsontag) = "query,omitempty", (gogoproto.moretags) = 'structs:"query,omitempty" mapstructure:"query,omitempty"'];
    string owner = 3                 [(gogoproto.jsontag) = "owner,omitempty", (gogoproto.moretags) = 'structs:"owner,omitempty" mapstructure:"owner,omitempty"'];
    repeated OrderBy order = 4       [(gogoproto.jsontag) = "order,omitempty", (gogoproto.moretags) = 'structs:"order,omitempty" mapstructure:"order,omitempty"'];
    int32 limit = 5                  [(gogoproto.jsontag) = "limit,omitempty", (gogoproto.moretags) = 'structs:"limit,omitempty" mapstructure:"limit,omitempty"']; 
    string mapping = 6               [(gogoproto.jsontag) = "mapping,omitempty", (gogoproto.moretags) = 'structs:"mapping,omitempty" mapstructure:"mapping,omitempty"']; 
}

// UpdateObjectsMsg represents parameters for updating objects
message UpdateObjectsMsg {
    string bucket = 1               [(gogoproto.jsontag) = "bucket,omitempty", (gogoproto.moretags) = 'structs:"bucket,omitempty" mapstructure:"bucket,omitempty"'];
    bytes query = 2                 [(gogoproto.jsontag) = "query,omitempty", (gogoproto.moretags) = 'structs:"query,omitempty" mapstructure:"query,omitempty"'];
    string owner = 3                [(gogoproto.jsontag) = "owner,omitempty", (gogoproto.moretags) = 'structs:"owner,omitempty" mapstructure:"owner,omitempty"'];
    bytes update = 4               [(gogoproto.jsontag) = "update,omitempty", (gogoproto.moretags) = 'structs:"update,omitempty" mapstructure:"update,omitempty"'];
    string mapping = 5              [(gogoproto.jsontag) = "mapping,omitempty", (gogoproto.moretags) = 'structs:"mapping,omitempty" mapstructure:"mapping,omitempty"']; 
}

// DeleteObjects represents parameter for deleting objects
message DeleteObjectsMsg {
    string bucket = 1               [(gogoproto.jsontag) = "bucket,omitempty", (gogoproto.moretags) = 'structs:"bucket,omitempty" mapstructure:"bucket,omitempty"'];
    bytes query = 2                 [(gogoproto.jsontag) = "query,omitempty", (gogoproto.moretags) = 'structs:"query,omitempty" mapstructure:"query,omitempty"'];
    string owner = 3                [(gogoproto.jsontag) = "owner,omitempty", (gogoproto.moretags) = 'structs:"owner,omitempty" mapstructure:"owner,omitempty"'];
    string mapping = 4              [(gogoproto.jsontag) = "mapping,omitempty", (gogoproto.moretags) = 'structs:"mapping,omitempty" mapstructure:"mapping,omitempty"']; 
}

// AffectedResponse 
message AffectedResponse {
    int64 affected  = 1              [(gogoproto.jsontag) = "bucket,omitempty", (gogoproto.moretags) = 'structs:"bucket,omitempty" mapstructure:"bucket,omitempty"'];    
}

// OrderBy represents how a field is ordered in a query
message OrderBy {
    string field = 1        [(gogoproto.jsontag) = "field,omitempty", (gogoproto.moretags) = 'structs:"field,omitempty" mapstructure:"field,omitempty"'];
    int32 order = 2         [(gogoproto.jsontag) = "order,omitempty", (gogoproto.moretags) = 'structs:"order,omitempty" mapstructure:"order,omitempty"'];
}

// Session represents a database session request body
message Session {
    string ID = 1 [(gogoproto.jsontag) = "id,omitempty", (gogoproto.moretags) = 'structs:"id,omitempty" mapstructure:"id,omitempty"'];
}


// CreateObjects represents a collection of objects to be created
message CreateObjectsMsg {
    
    // The bucket name to associated object to
    string bucket = 1              [(gogoproto.jsontag) = "bucket_id,omitempty", (gogoproto.moretags) = 'structs:"bucket_id,omitempty" mapstructure:"bucket_id,omitempty"'];
    
    // Must be a slice of Objects encoded in json
    bytes objects = 2               [(gogoproto.jsontag) = "objects,omitempty", (gogoproto.moretags) = 'structs:"objects,omitempty" mapstructure:"objects,omitempty"'];
    
    // Optional mapping to use during object decoding
    string mapping = 3              [(gogoproto.jsontag) = "mapping,omitempty", (gogoproto.moretags) = 'structs:"mapping,omitempty" mapstructure:"mapping,omitempty"'];
}

// CreateAccountMsg represents an account of a person, developer or organization
message CreateAccountMsg {
    string email = 1            [(gogoproto.jsontag) = "email,omitempty", (gogoproto.moretags) = 'structs:"email,omitempty" mapstructure:"email,omitempty"'];
    string password = 2         [(gogoproto.jsontag) = "password,omitempty", (gogoproto.moretags) = 'structs:"password,omitempty" mapstructure:"password,omitempty"'];
    bool developer = 3          [(gogoproto.jsontag) = "developer,omitempty", (gogoproto.moretags) = 'structs:"developer,omitempty" mapstructure:"developer,omitempty"'];
    string firstName = 4        [(gogoproto.jsontag) = "first_name,omitempty", (gogoproto.moretags) = 'structs:"first_name,omitempty" mapstructure:"first_name,omitempty"'];
    string lastName = 5         [(gogoproto.jsontag) = "last_name,omitempty", (gogoproto.moretags) = 'structs:"last_name,omitempty" mapstructure:"last_name,omitempty"'];
    string clientID = 6         [(gogoproto.jsontag) = "client_id,omitempty", (gogoproto.moretags) = 'structs:"client_id,omitempty" mapstructure:"client_id,omitempty"'];
    string clientSecret = 7     [(gogoproto.jsontag) = "client_secret,omitempty", (gogoproto.moretags) = 'structs:"client_secret,omitempty" mapstructure:"client_secret,omitempty"'];
}

// GetObjectResponse describes a response of single object
message GetObjectResponse {
    bytes object  = 1             [(gogoproto.jsontag) = "data,omitempty", (gogoproto.moretags) = 'structs:"data,omitempty" mapstructure:"data,omitempty"'];
}

// GetObjectsResponse describes a response of multiple objects
message GetObjectsResponse {
    bytes objects  = 1             [(gogoproto.jsontag) = "data,omitempty", (gogoproto.moretags) = 'structs:"data,omitempty" mapstructure:"data,omitempty"'];
}

// Object describes an object
message Object {
    string ID = 1              [(gogoproto.jsontag) = "id,omitempty", (gogoproto.moretags) = 'structs:"id,omitempty" mapstructure:"id,omitempty"'];
    string ownerID = 2         [(gogoproto.jsontag) = "owner_id,omitempty", (gogoproto.moretags) = 'structs:"owner_id,omitempty" mapstructure:"owner_id,omitempty"'];
    string creatorID = 3       [(gogoproto.jsontag) = "creator_id,omitempty", (gogoproto.moretags) = 'structs:"creator_id,omitempty" mapstructure:"creator_id,omitempty"'];
    string partitionID = 4     [(gogoproto.jsontag) = "partition_id,omitempty", (gogoproto.moretags) = 'structs:"partition_id,omitempty" mapstructure:"partition_id,omitempty"'];
    string key = 5             [(gogoproto.jsontag) = "key,omitempty", (gogoproto.moretags) = 'structs:"key,omitempty" mapstructure:"key,omitempty"'];
    string value = 6           [(gogoproto.jsontag) = "value,omitempty", (gogoproto.moretags) = 'structs:"value,omitempty" mapstructure:"value,omitempty"'];
    bool protected = 7         [(gogoproto.jsontag) = "protected,omitempty", (gogoproto.moretags) = 'structs:"protected,omitempty" mapstructure:"protected,omitempty"'];
    bool refOnly = 8           [(gogoproto.jsontag) = "ref_only,omitempty", (gogoproto.moretags) = 'structs:"ref_only,omitempty" mapstructure:"ref_only,omitempty"'];
    int64 timestamp = 9        [(gogoproto.jsontag) = "timestamp,omitempty", (gogoproto.moretags) = 'structs:"timestamp,omitempty" mapstructure:"timestamp,omitempty"'];
    string prevHash = 10       [(gogoproto.jsontag) = "prev_hash,omitempty", (gogoproto.moretags) = 'structs:"prev_hash,omitempty" mapstructure:"prev_hash,omitempty"'];
    string peerHash = 11       [(gogoproto.jsontag) = "peer_hash,omitempty", (gogoproto.moretags) = 'structs:"peer_hash,omitempty" mapstructure:"peer_hash,omitempty"'];
    string hash = 12           [(gogoproto.jsontag) = "hash,omitempty", (gogoproto.moretags) = 'structs:"hash,omitempty" mapstructure:"hash,omitempty"'];
    string ref1 = 13           [(gogoproto.jsontag) = "ref1,omitempty", (gogoproto.moretags) = 'structs:"ref1,omitempty" mapstructure:"ref1,omitempty"'];
    string ref2 = 14           [(gogoproto.jsontag) = "ref2,omitempty", (gogoproto.moretags) = 'structs:"ref2,omitempty" mapstructure:"ref2,omitempty"'];
    string ref3 = 15           [(gogoproto.jsontag) = "ref3,omitempty", (gogoproto.moretags) = 'structs:"ref3,omitempty" mapstructure:"ref3,omitempty"'];
    string ref4 = 16           [(gogoproto.jsontag) = "ref4,omitempty", (gogoproto.moretags) = 'structs:"ref4,omitempty" mapstructure:"ref4,omitempty"'];
    string ref5 = 17           [(gogoproto.jsontag) = "ref5,omitempty", (gogoproto.moretags) = 'structs:"ref5,omitempty" mapstructure:"ref5,omitempty"'];
    string ref6 = 18           [(gogoproto.jsontag) = "ref6,omitempty", (gogoproto.moretags) = 'structs:"ref6,omitempty" mapstructure:"ref6,omitempty"'];
    string ref7 = 19           [(gogoproto.jsontag) = "ref7,omitempty", (gogoproto.moretags) = 'structs:"ref7,omitempty" mapstructure:"ref7,omitempty"'];
    string ref8 = 20           [(gogoproto.jsontag) = "ref8,omitempty", (gogoproto.moretags) = 'structs:"ref8,omitempty" mapstructure:"ref8,omitempty"'];
    string ref9 = 21           [(gogoproto.jsontag) = "ref9,omitempty", (gogoproto.moretags) = 'structs:"ref9,omitempty" mapstructure:"ref9,omitempty"'];
    string ref10 = 22          [(gogoproto.jsontag) = "ref10,omitempty", (gogoproto.moretags) = 'structs:"ref10,omitempty" mapstructure:"ref10,omitempty"'];
}